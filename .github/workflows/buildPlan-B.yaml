
# projects total:     253
# min stars count:    -1
# max projects count: 1000

name: "Execute Open Community Build plan"
on:
  workflow_call:
    inputs:
      published-scala-version:
        type: string
        description: 'Published Scala version to use, if empty new version of compiler would be build with default name based on the selected repository'
      repository-url:
        type: string
        description: "GitHub repository URL for compiler to build, ignored when published-scala-version is defined"
        default: "lampepfl/dotty"
      repository-branch:
        type: string
        description: "GitHub repository branch for compiler to build, ignored when published-scala-version is defined"
        default: "main"
      extra-scalac-options:
        type: string
        description: "List of scalacOptions which should be used when building projects. Multiple entires should be seperated by a single comma character `,`"
        default: ""
      disabled-scalac-options:
        type: string
        description: "List of scalacOptions which should be filtered out when building projects."
        default: ""
      custom-build-id:
        type: string
        description: "Custom buildId to use instead of autogenerated github job id"
        default: ""
    outputs:
      used-scala-version:
        description: "Version of Scala used to run the build"
        value: ${{ jobs.setup-build.outputs.scala-version }}
    secrets:
      OPENCB_ELASTIC_USER:
        required: true
      OPENCB_ELASTIC_PSWD:
        required: true

jobs:
  setup-build:
    runs-on: ubuntu-22.04
    continue-on-error: false
    outputs:
      scala-version:  ${{ steps.setup.outputs.scala-version }}
      maven-repo-url: ${{ steps.setup.outputs.maven-repo-url }}
    steps:
      - name: "Git Checkout"
        uses: actions/checkout@v3
      - name: "Setup build"
        uses: ./.github/actions/setup-build
        id: setup
        with:
          scala-version: ${{ inputs.published-scala-version }}
          repository-url: ${{ inputs.repository-url }}
          repository-branch: ${{ inputs.repository-branch }}

  stage-0:
    runs-on: ubuntu-22.04
    needs: [ setup-build ]
    continue-on-error: true
    timeout-minutes: 360
    strategy:
      matrix:
        include:
        - name: "aaronp/code-template"
        - name: "aaronp/franz"
        - name: "ablearthy/td-types"
        - name: "ablearthy/tdjson-bind"
        - name: "acsgh/scala-common"
        - name: "ahjohannessen/smithy4s-repro-lib"
        - name: "ahjohannessen/unum"
        - name: "aiyanbo/scala-i18n"
        - name: "ajozwik/protoquill-generic"
        - name: "akiomik/seaw"
        - name: "alejandrohdezma/dummy"
        - name: "alejandrohdezma/sbt-mdoc-toc"
        - name: "alejandrohdezma/sbt-propagate"
        - name: "alexarchambault/case-app-entrypoint-annotation"
        - name: "alexarchambault/class-path-inspector"
        - name: "alexdupre/coinpayments-scala"
        - name: "aoiroaoino/nanolens"
        - name: "aparo/zio-json-extra"
        - name: "armanbilge/feral"
        - name: "armanbilge/fs2"
        - name: "armanbilge/munit-cats-effect"
        - name: "armanbilge/saslprep"
        - name: "armanbilge/scalacheck-effect"
        - name: "atedeg/scala-release"
        - name: "barnardb/tinyplate"
        - name: "beangle/db"
        - name: "beangle/doc"
        - name: "beangle/ids"
        - name: "beangle/notify"
        - name: "benoitlouy/tele"
        - name: "besselstudio/coingecko"
        - name: "bilal-fazlani/circe-json-schema"
        - name: "bilal-fazlani/csv-schema"
        - name: "bilal-fazlani/jslt-parser"
        - name: "bilal-fazlani/rainbowcli"
        - name: "bilal-fazlani/zio-mongo"
        - name: "bitmarck-service/fs2-secon"
        - name: "bp3r/jsonrpc2"
        - name: "carlos-verdes/zio-resource"
        - name: "catap/scala-blake3"
        - name: "catap/scala-sha"
        - name: "christian-schlichtherle/circe-kafka"
        - name: "clockworkconsulting/csexp"
        - name: "clockworkconsulting/peregrin"
        - name: "clulab/fatdynet"
        - name: "cornerman/simple-scalajs-requests"
        - name: "coursier/class-path-util"
        - name: "creativescala/doodle-explore"
        - name: "cric96/distributed-frp"
        - name: "cucumber/action-publish-sbt"
        - name: "dacr/json2props"
        - name: "dacr/split"
        - name: "dacr/unittools"
        - name: "daghemberg/paut-program"
        - name: "daghemberg/problemutils"
        - name: "davenverse/epimetheus-circuit"
        - name: "davenverse/namecase"
        - name: "davenverse/natchez-local"
        - name: "davenverse/publicsuffix"
        - name: "dragonfly-ai/democrossy"
        - name: "eikek/bitpeace"
        - name: "errors4s/errors4s-core-scalacheck"
        - name: "errors4s/errors4s-http"
        - name: "estrondo/sweet-mockito"
        - name: "fgrutsch/akka-persistence-mapdb"
        - name: "fiatjaf/nlog"
        - name: "frawa/inline-files"
        - name: "gchudnov/mindthegap"
        - name: "gemini-hlsw/lucuma-jts"
        - name: "gemini-hlsw/lucuma-schemas"
        - name: "giabao/asm-flow"
        - name: "gnp/zio-data-streams"
        - name: "gochaorg/json4s3"
        - name: "greenfossil/typesafe-config-ext"
        - name: "guymers/ceesvee"
        - name: "guymers/foobie"
        - name: "gzoller/deploysample"
        - name: "herminiogg/dmaog"
        - name: "herminiogg/label2thesaurus"
        - name: "hireproof/screening"
        - name: "hnaderi/named-codec"
        - name: "hnaderi/scala-readpass"
        - name: "hsci-r/lucene-perfieldpostingsformatordtermvectorscodec"
        - name: "hughsimpson/scalameter"
        - name: "indoorvivants/detective"
        - name: "indoorvivants/opaque-newtypes"
        - name: "indoorvivants/yank"
        - name: "ingarabr/http4s-cloud-functions"
        - name: "ivoah/vial"
        - name: "janlisse/zio-jwt-validator"
        - name: "jodersky/identicon"
        - name: "jodersky/redicl"
        - name: "jodersky/ustats"
        - name: "johnhungerford/generic-schema"
        - name: "joohnnie/retry"
        - name: "jphmrst/scala-automata"
        - name: "jphmrst/scalautils"
        - name: "kalin-rudnicki/harness"
        - name: "karazinscalausersgroup/mongo-literals"
        - name: "katrix/minejson"
        - name: "kevin-lee/just-sysprocess"
        - name: "kijuky/enumeratum-scalikejdbc"
        - name: "kordyjan/typelogger"
        - name: "krrrr38/protoquill-finagle-mysql"
        - name: "l-space/types"
        - name: "lhns/cats-effect-utils"
        - name: "lhns/doobie-flyway"
        - name: "lhns/fs2-utils"
        - name: "lhns/nifi-scala"
        - name: "lhns/scala-commandline"
        - name: "lhns/scala-trustmanager-utils"
        - name: "liewhite/common"
        - name: "likeligood-ab/scala-react"
        - name: "losizm/bolster"
        - name: "losizm/ergo"
        - name: "losizm/little-cli"
        - name: "losizm/little-io"
        - name: "losizm/little-security"
        - name: "losizm/little-sql"
        - name: "losizm/t2"
        - name: "malliina/sbt-utils"
        - name: "malliina/util-base"
        - name: "malyszaryczlowiek/foo-repo"
        - name: "malyszaryczlowiek/kessenger-lib"
        - name: "massimosiani/monix-newtypes-cats"
        - name: "massimosiani/skunk"
        - name: "mattlangsenkamp/svgbounds"
        - name: "mdedetrich/scalacheck"
        - name: "mixql/mixql-protobuf"
        - name: "mkroli/lpm"
        - name: "mutsuhiro6/ulid-scala3"
        - name: "mvv/typine"
        - name: "nafg/cloud-logging-logback-scala"
        - name: "nafg/scheduler"
        - name: "nafg/simple-router"
        - name: "narma/zio-docker"
        - name: "nationalarchives/dr2-preservica-client"
        - name: "openmole/container"
        - name: "outr/dd-scala"
        - name: "outr/moduload"
        - name: "outr/sendgrid4s"
        - name: "pbyrne84/scala-case-class-prettification"
        - name: "pbyrne84/scala-wiremock-api"
        - name: "permutive-engineering/refreshable"
        - name: "phillhenry/dreadnought"
        - name: "pjfanning/jackson-module-scala-duration"
        - name: "pjfanning/scala3-sample-classes"
        - name: "pmeheut/nscala-java-time"
        - name: "pureharm/pureharm-core"
        - name: "rtyley/rate-limit-status"
        - name: "rtyley/scala-collection-plus"
        - name: "ruimo/gh-sonatype-example"
        - name: "ruimo/scoins"
        - name: "sakulk/serval"
        - name: "sangria-graphql/sangria-marshalling-testkit"
        - name: "scala-cli/java-class-name"
        - name: "scf37/filewatch"
        - name: "sciss/audiowidgets"
        - name: "sciss/filecache"
        - name: "sciss/log"
        - name: "sciss/lucrepi"
        - name: "sciss/model"
        - name: "sciss/optional"
        - name: "sciss/scalacollider-dot"
        - name: "sciss/scalacollider-if"
        - name: "sdrafahl/codec"
        - name: "sean-ideabank/rudolf"
        - name: "shawjef3/tryutils"
        - name: "shopstic/caliban"
        - name: "sinaghaffari/monadicsimplifier"
        - name: "snowplow/iglu-scala-core"
        - name: "swagger-akka-http/swagger-scala3-enum-module"
        - name: "swaldman/audiofluidity-rss"
        - name: "swaldman/mlog-scala"
        - name: "sweet-delights/delightful-typeclasses"
        - name: "t-sasaki915/typesafe-scalajs"
        - name: "taig/cloud-sql-proxy"
        - name: "taig/object-fit"
        - name: "taig/scala-linguist"
        - name: "taig/scala-pygments"
        - name: "taig/skunk-ext"
        - name: "tharwaninitin/cache4s"
        - name: "tharwaninitin/crypto4s"
        - name: "timbertson/auditspec"
        - name: "timbertson/backpressure-sensor"
        - name: "tkrs/mess"
        - name: "tkrs/mmdb-grpc-scala"
        - name: "tlsomers/scala-suspendable"
        - name: "tmccarthy/ausgeo"
        - name: "tmccarthy/digest4s"
        - name: "tmccarthy/scala-db"
        - name: "tmccarthy/tmmutils"
        - name: "todokr/grokschema"
        - name: "trace4cats/trace4cats-exporter-http"
        - name: "trace4cats/trace4cats-natchez"
        - name: "trace4cats/trace4cats-tail-sampling-extras"
        - name: "typesafeconfigops/typesafeconfigops"
        - name: "varwise/prometheus-akka-http"
        - name: "vasilmkd/discipline"
        - name: "virtuslab/scala-cli-signing"
        - name: "vlmiroshnikov/saga"
        - name: "wiringbits/wiringbits-webapp-utils"
        - name: "xuwei-k/scala3profile"
        - name: "yrichika/scalahtml"
        - name: "yurikpanic/zio-postgres"
        - name: "yurique/embedded-files-macro"
        - name: "zygfryd/scala-zygf-jackshaft"
    steps:
      - name: "Git Checkout"
        uses: actions/checkout@v3
      - name: "Build project"
        uses: ./.github/actions/build-project
        timeout-minutes: 360
        with:
          project-name: ${{ matrix.name }}
          custom-build-id: ${{ inputs.custom-build-id }}
          extra-scalac-options: ${{ inputs.extra-scalac-options }}
          disabled-scalac-options: ${{ inputs.disabled-scalac-options }}
          scala-version: ${{ needs.setup-build.outputs.scala-version }}
          maven-repo-url: ${{ needs.setup-build.outputs.maven-repo-url }}
          elastic-user: ${{ secrets.OPENCB_ELASTIC_USER }}
          elastic-password: ${{ secrets.OPENCB_ELASTIC_PSWD }}
  stage-1:
    runs-on: ubuntu-22.04
    needs: [ setup-build ]
    continue-on-error: true
    timeout-minutes: 360
    strategy:
      matrix:
        include:
        - name: "andimiller/munit-cats-effect-styles"
        - name: "armanbilge/ip4s"
        - name: "armanbilge/jawn-fs2"
        - name: "armanbilge/log4cats"
        - name: "armanbilge/stratus"
        - name: "beangle/otk"
        - name: "davenverse/epimetheus-rediculous"
        - name: "dwolla/epimetheus-server"
        - name: "errors4s/errors4s-core-cats"
        - name: "frawa/typed-json"
        - name: "funkode-io/web3-auth"
        - name: "hnaderi/portainer-client"
        - name: "hsci-r/octavo-indexer"
        - name: "indoorvivants/mdoc-d2"
        - name: "kalin-rudnicki/slyce-zio"
        - name: "mixql/mixql-engine"
        - name: "pismute/classy-optics"
        - name: "pureharm/pureharm-config-ciris"
        - name: "pureharm/pureharm-db-core-jdbc"
        - name: "pureharm/pureharm-effects-cats"
        - name: "ruimo/csvparser"
        - name: "ruimo/graphics"
        - name: "sangria-graphql/sangria-json4s-native"
        - name: "sciss/asyncfile"
        - name: "sciss/lucreswing"
        - name: "sciss/sonogramoverview"
        - name: "swaldman/failable"
        - name: "sweet-delights/delightful-parsing"
        - name: "tmccarthy/tmm-scala-collections"
        - name: "trace4cats/trace4cats-jaeger"
        - name: "trace4cats/trace4cats-newrelic"
        - name: "trace4cats/trace4cats-zipkin"
        - name: "valencik/textmogrify"
        - name: "vasilmkd/discipline-specs2"
    steps:
      - name: "Git Checkout"
        uses: actions/checkout@v3
      - name: "Build project"
        uses: ./.github/actions/build-project
        timeout-minutes: 60
        with:
          project-name: ${{ matrix.name }}
          custom-build-id: ${{ inputs.custom-build-id }}
          extra-scalac-options: ${{ inputs.extra-scalac-options }}
          disabled-scalac-options: ${{ inputs.disabled-scalac-options }}
          scala-version: ${{ needs.setup-build.outputs.scala-version }}
          maven-repo-url: ${{ needs.setup-build.outputs.maven-repo-url }}
          elastic-user: ${{ secrets.OPENCB_ELASTIC_USER }}
          elastic-password: ${{ secrets.OPENCB_ELASTIC_PSWD }}
  stage-2:
    runs-on: ubuntu-22.04
    needs: [ setup-build, stage-1 ]
    continue-on-error: true
    timeout-minutes: 360
    strategy:
      matrix:
        include:
        - name: "armanbilge/cheshire"
        - name: "gemini-hlsw/lucuma-itc"
        - name: "permutive-engineering/functional-google-clients"
        - name: "permutive-engineering/odin-contrib"
        - name: "permutive-engineering/prometheus4cats-contrib"
        - name: "pureharm/pureharm-testkit"
        - name: "tmccarthy/fetch"
        - name: "trace4cats/trace4cats-avro"
        - name: "trace4cats/trace4cats-cloudtrace"
        - name: "typelevel/log4cats-natchez"
    steps:
      - name: "Git Checkout"
        uses: actions/checkout@v3
      - name: "Build project"
        uses: ./.github/actions/build-project
        timeout-minutes: 60
        with:
          project-name: ${{ matrix.name }}
          custom-build-id: ${{ inputs.custom-build-id }}
          extra-scalac-options: ${{ inputs.extra-scalac-options }}
          disabled-scalac-options: ${{ inputs.disabled-scalac-options }}
          scala-version: ${{ needs.setup-build.outputs.scala-version }}
          maven-repo-url: ${{ needs.setup-build.outputs.maven-repo-url }}
          elastic-user: ${{ secrets.OPENCB_ELASTIC_USER }}
          elastic-password: ${{ secrets.OPENCB_ELASTIC_PSWD }}
  stage-3:
    runs-on: ubuntu-22.04
    needs: [ setup-build, stage-2 ]
    continue-on-error: true
    timeout-minutes: 360
    strategy:
      matrix:
        include:
        - name: "pureharm/pureharm-db-core"
        - name: "trace4cats/trace4cats-avro-kafka"
    steps:
      - name: "Git Checkout"
        uses: actions/checkout@v3
      - name: "Build project"
        uses: ./.github/actions/build-project
        timeout-minutes: 60
        with:
          project-name: ${{ matrix.name }}
          custom-build-id: ${{ inputs.custom-build-id }}
          extra-scalac-options: ${{ inputs.extra-scalac-options }}
          disabled-scalac-options: ${{ inputs.disabled-scalac-options }}
          scala-version: ${{ needs.setup-build.outputs.scala-version }}
          maven-repo-url: ${{ needs.setup-build.outputs.maven-repo-url }}
          elastic-user: ${{ secrets.OPENCB_ELASTIC_USER }}
          elastic-password: ${{ secrets.OPENCB_ELASTIC_PSWD }}
