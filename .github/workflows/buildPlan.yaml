
# projects total:     119
# min stars count:    -1
# max projects count: 0

name: "Execute Open Community Build plan"
on:
  workflow_call:
    inputs:
      published-scala-version:
        type: string
        description: 'Published Scala version to use, if empty new version of compiler would be build with default name based on the selected repository'
      repository-url:
        type: string
        description: "GitHub repository URL for compiler to build, ignored when published-scala-version is defined"
        default: "lampepfl/dotty"
      repository-branch:
        type: string
        description: "GitHub repository branch for compiler to build, ignored when published-scala-version is defined"
        default: "main"
      extra-scalac-options:
        type: string
        description: "List of scalacOptions which should be used when building projects. Multiple entires should be seperated by a single comma character `,`"
        default: ""
      disabled-scalac-options:
        type: string
        description: "List of scalacOptions which should be filtered out when building projects."
        default: ""
    outputs:
      used-scala-version:
        description: "Version of Scala used to run the build"
        value: ${{ jobs.setup-build.outputs.scala-version }}
    secrets:
      OPENCB_ELASTIC_USER:
        required: true
      OPENCB_ELASTIC_PSWD:
        required: true

jobs:
  setup-build:
    runs-on: ubuntu-22.04
    continue-on-error: false
    outputs:
      scala-version:  ${{ steps.setup.outputs.scala-version }}
      maven-repo-url: ${{ steps.setup.outputs.maven-repo-url }}
    steps:
      - name: "Git Checkout"
        uses: actions/checkout@v3
      - name: "Setup build"
        uses: ./.github/actions/setup-build
        id: setup
        with:
          scala-version: ${{ inputs.published-scala-version }}
          repository-url: ${{ inputs.repository-url }}
          repository-branch: ${{ inputs.repository-branch }}

  stage-0:
    runs-on: ubuntu-22.04
    needs: [ setup-build ]
    continue-on-error: true
    timeout-minutes: 360
    strategy:
      matrix:
        include:
        - name: "2m/yabai-scala"
        - name: "abdolence/circe-tagged-adt-codec"
        - name: "adampingel/axle-cicd"
        - name: "alexandru/alexandru"
        - name: "alexarchambault/scalacon-2022-demo"
        - name: "alexarchambault/scalacon2022-demo"
        - name: "almond-sh/almond"
        - name: "aptusproject/aptus-core"
        - name: "arturopala/gitignore"
        - name: "atedeg/scala-release"
        - name: "beangle/commons"
        - name: "carlos-verdes/funkode"
        - name: "caspercommunityio/casper-scala-sdk"
        - name: "cchantep/play-reactivemongo"
        - name: "com-lihaoyi/ammonite"
        - name: "coursier/dependency"
        - name: "cucumber/action-publish-sbt"
        - name: "dacr/lorem-ipsum"
        - name: "dataoperandz/cassper"
        - name: "davidledwards/zookeeper"
        - name: "dmurvihill/courier"
        - name: "dmytromitin/dotty-patched"
        - name: "e257-fi/dirsuite"
        - name: "eclipse-pass/pass-java-client"
        - name: "eed3si9n/sbt-coursier"
        - name: "emartech/escher-akka-http"
        - name: "errors4s/errors4s-core-circe"
        - name: "es-meta/esmeta"
        - name: "fehu/opentracing-scala"
        - name: "finos/morphir-scala"
        - name: "guardian/support-frontend"
        - name: "gzoller/scala-reflection"
        - name: "ichoran/kse3"
        - name: "iltotore/iron"
        - name: "inkytonik/kiama"
        - name: "j-mie6/parsley"
        - name: "jcouyang/meow"
        - name: "jelly-rdf/jelly-jvm"
        - name: "joan38/kubernetes-client"
        - name: "johnhungerford/generic-schema"
        - name: "jphmrst/scala-automata"
        - name: "jphmrst/scala-outlines"
        - name: "jsfwa/zio-cassandra"
        - name: "jvican/dijon"
        - name: "kag0/ninny-json"
        - name: "kailuowang/pencil"
        - name: "karazinscalausersgroup/circe-literal-extras"
        - name: "kevin-lee/can-equal"
        - name: "kevin-lee/extras"
        - name: "kevin-lee/just-fp"
        - name: "labra/srdf"
        - name: "laserdisc-io/fs2-aws"
        - name: "line/armeria"
        - name: "lorandszakacs/sprout"
        - name: "makenowjust-labs/lite"
        - name: "mdedetrich/scalajson"
        - name: "mpollmeier/scala-repl-pp"
        - name: "msgpack4z/msgpack4z-native"
        - name: "neandertech/jsonrpclib"
        - name: "nrinaudo/kantan.repl"
        - name: "nrktkt/ninny-json"
        - name: "oleg-py/shironeko"
        - name: "openlink/virtuoso-opensource"
        - name: "outr/testy"
        - name: "oyvindberg/bleep"
        - name: "oyvindberg/tui-scala"
        - name: "pdal/java"
        - name: "percontmx/cfdi"
        - name: "pityka/aten-scala"
        - name: "pjfanning/scala3-reflection"
        - name: "playframework/playframework"
        - name: "primetalk/typed-ontology"
        - name: "quafadas/scautable"
        - name: "rmgk/slips"
        - name: "rocketfuel/sdbc"
        - name: "rssh/scala-gopher"
        - name: "sbrunk/tokenizers-scala"
        - name: "scala-js/scala-js-macrotask-executor"
        - name: "scalax/simple"
        - name: "sciss/processor"
        - name: "sciss/scala-chart"
        - name: "sciss/serial"
        - name: "sciss/swingplus"
        - name: "sdrafahl/migratepipeline"
        - name: "sensorsdata/sa-sdk-android-plugin2"
        - name: "simy4/xpath-to-xml"
        - name: "stryker-mutator/mutation-testing-elements"
        - name: "tabdulradi/mazboot"
        - name: "tinkoff/phobos"
        - name: "tlsomers/scala-suspendable"
        - name: "virtuslab/pretty-stacktraces"
        - name: "wangzaixiang/wjson"
        - name: "wireapp/wire-signals"
        - name: "xebia-functional/xef"
        - name: "xuwei-k/wartremover-scalikejdbc"
        - name: "zio/zio-aws"
        - name: "zygfryd/scala-zygf-cement"
    steps:
      - name: "Git Checkout"
        uses: actions/checkout@v3
      - name: "Build project"
        uses: ./.github/actions/build-project
        timeout-minutes: 360
        with:
          project-name: ${{ matrix.name }}
          extra-scalac-options: ${{ inputs.extra-scalac-options }}
          disabled-scalac-options: ${{ inputs.disabled-scalac-options }}
          scala-version: ${{ needs.setup-build.outputs.scala-version }}
          maven-repo-url: ${{ needs.setup-build.outputs.maven-repo-url }}
          elastic-user: ${{ secrets.OPENCB_ELASTIC_USER }}
          elastic-password: ${{ secrets.OPENCB_ELASTIC_PSWD }}
  stage-1:
    runs-on: ubuntu-22.04
    needs: [ setup-build ]
    continue-on-error: true
    timeout-minutes: 360
    strategy:
      matrix:
        include:
        - name: "beangle/boot"
        - name: "beangle/cache"
        - name: "beangle/cdi"
        - name: "beangle/data"
        - name: "beangle/template"
        - name: "beangle/web"
        - name: "kevin-lee/logger-f"
        - name: "kevin-lee/maven2sbt"
        - name: "pjfanning/jackson-scala3-reflection-extensions"
        - name: "playframework/play-mailer"
        - name: "playframework/scalatestplus-play"
        - name: "pme123/camundala-dsl"
        - name: "sciss/fscape-next"
        - name: "sciss/pdflitz"
        - name: "sciss/scalainterpreterpane"
        - name: "sciss/span"
        - name: "vigoo/zio-aws"
        - name: "webjars/webjars-play"
    steps:
      - name: "Git Checkout"
        uses: actions/checkout@v3
      - name: "Build project"
        uses: ./.github/actions/build-project
        timeout-minutes: 60
        with:
          project-name: ${{ matrix.name }}
          extra-scalac-options: ${{ inputs.extra-scalac-options }}
          disabled-scalac-options: ${{ inputs.disabled-scalac-options }}
          scala-version: ${{ needs.setup-build.outputs.scala-version }}
          maven-repo-url: ${{ needs.setup-build.outputs.maven-repo-url }}
          elastic-user: ${{ secrets.OPENCB_ELASTIC_USER }}
          elastic-password: ${{ secrets.OPENCB_ELASTIC_PSWD }}
  stage-2:
    runs-on: ubuntu-22.04
    needs: [ setup-build, stage-1 ]
    continue-on-error: true
    timeout-minutes: 360
    strategy:
      matrix:
        include:
        - name: "beangle/serializer"
        - name: "beangle/webmvc"
    steps:
      - name: "Git Checkout"
        uses: actions/checkout@v3
      - name: "Build project"
        uses: ./.github/actions/build-project
        timeout-minutes: 60
        with:
          project-name: ${{ matrix.name }}
          extra-scalac-options: ${{ inputs.extra-scalac-options }}
          disabled-scalac-options: ${{ inputs.disabled-scalac-options }}
          scala-version: ${{ needs.setup-build.outputs.scala-version }}
          maven-repo-url: ${{ needs.setup-build.outputs.maven-repo-url }}
          elastic-user: ${{ secrets.OPENCB_ELASTIC_USER }}
          elastic-password: ${{ secrets.OPENCB_ELASTIC_PSWD }}
  stage-3:
    runs-on: ubuntu-22.04
    needs: [ setup-build, stage-2 ]
    continue-on-error: true
    timeout-minutes: 360
    strategy:
      matrix:
        include:
        - name: "beangle/security"
    steps:
      - name: "Git Checkout"
        uses: actions/checkout@v3
      - name: "Build project"
        uses: ./.github/actions/build-project
        timeout-minutes: 60
        with:
          project-name: ${{ matrix.name }}
          extra-scalac-options: ${{ inputs.extra-scalac-options }}
          disabled-scalac-options: ${{ inputs.disabled-scalac-options }}
          scala-version: ${{ needs.setup-build.outputs.scala-version }}
          maven-repo-url: ${{ needs.setup-build.outputs.maven-repo-url }}
          elastic-user: ${{ secrets.OPENCB_ELASTIC_USER }}
          elastic-password: ${{ secrets.OPENCB_ELASTIC_PSWD }}
  stage-4:
    runs-on: ubuntu-22.04
    needs: [ setup-build, stage-3 ]
    continue-on-error: true
    timeout-minutes: 360
    strategy:
      matrix:
        include:
        - name: "beangle/ems"
    steps:
      - name: "Git Checkout"
        uses: actions/checkout@v3
      - name: "Build project"
        uses: ./.github/actions/build-project
        timeout-minutes: 60
        with:
          project-name: ${{ matrix.name }}
          extra-scalac-options: ${{ inputs.extra-scalac-options }}
          disabled-scalac-options: ${{ inputs.disabled-scalac-options }}
          scala-version: ${{ needs.setup-build.outputs.scala-version }}
          maven-repo-url: ${{ needs.setup-build.outputs.maven-repo-url }}
          elastic-user: ${{ secrets.OPENCB_ELASTIC_USER }}
          elastic-password: ${{ secrets.OPENCB_ELASTIC_PSWD }}
